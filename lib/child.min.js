(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};!function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(!a.Tagasauris)return p=function(a){var b,c,d,e,f,g,h,i,j;if(d=[],a instanceof Array)for(g=0,i=a.length;i>g;g++)c=a[g],c instanceof Array&&c.length>1&&d.push(""+c[0]+"="+encodeURIComponent(c[1]));else for(b in a)if(f=a[b],f instanceof Array)for(h=0,j=f.length;j>h;h++)e=f[h],d.push(""+b+"="+encodeURIComponent(e));else d.push(""+b+"="+encodeURIComponent(f));return d.join("&")},n=function(a){return a.replace(/(_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},o=function(a){return a.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},g=function(){function a(a){this.message=a,this.name="Exception"}return a.prototype.toString=function(){return this.message},a}(),d=function(){function a(){}return a.prototype.set=function(a,b){return this[a]=b},a.prototype.get=function(a,b){return null==b&&(b=null),this[a]||b},a}(),e=function(a){function c(a){null==a&&(a={}),this.set("logging",a.logging||!1)}return b(c,a),c.prototype.log=function(a){return this.get("logging")?console.log("Tagasauris."+this.constructor.name+": "+a):void 0},c}(d),k=function(c){function d(b){var c,e,f,h,i,j,k,l;if(null==b&&(b={}),d.__super__.constructor.call(this,b),!b.window)throw new g("Window is required");if(!b.target)throw new g("Target is required");for(c=a.addEventListener?"addEventListener":"attachEvent",e=a[c],h="attachEvent"===c?"onmessage":"message",e(h,this.notificationReceiver(this),!1),this.set("_window",b.window),this.set("_target",b.target),l=d.types,j=0,k=l.length;k>j;j++)i=l[j],f=n("on_"+i+"_receiver"),b[f]&&this.set(f,b[f])}var e,f,h,i;for(b(d,c),d.types=["start","started","success","error"],d.prototype.sendNotification=function(a,b){return null==b&&(b=""),this.log("Sending "+a),this._window.postMessage({type:a,notification:b},this._target)},d.prototype.notificationReceiver=function(a){return function(b){var c;return a.log("Received "+b.data.type+" from "+b.origin),0!==a._target.indexOf(b.origin)?a.log(new g("Invalid notification origin")):(c=n("on_"+b.data.type+"_receiver"),a[c]&&"function"==typeof a[c]?(a.log("Runing receiver "+c),a[c](b.data.notification)):void 0)}},i=d.types,f=0,h=i.length;h>f;f++)e=i[f],d.prototype[n("send_"+e)]=function(a){return function(b){return this.sendNotification(a,b)}}(e);return d}(e),j=function(a){function c(a){var b,c,d,e,f,g,h,i;for(null==a&&(a={}),a=this.toObject(a),h=this._fields,f=0,g=h.length;g>f;f++)i=h[f],d=i[0],b=i[1],e=a[d]||b,c=n("deserialize_"+d),this[c]&&"function"==typeof this[c]&&(e=this[c](d,e,a)),this.set(d,e)}return b(c,a),c.prototype._fields=[],c.prototype.toObject=function(a){var b,c,d;c={};for(b in a)d=a[b],c[n(b)]=d;return c},c.prototype.toJSON=function(){var a,b,c;b={};for(a in this)c=this[a],null!==c&&"_"!==a.substring(0,1)&&(b[o(a)]=c);return b},c}(d),h=function(a){function c(){return q=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype._fields=[["id",null],["type",null],["attributes",{}],["items",[]],["results",[]]],c.prototype.deserializeItems=function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(new i(c));return f},c.prototype.deserializeResults=function(a,b,c){var d,e,f,g;for(e=[],f=0,g=b.length;g>f;f++)d=b[f],d.mediaObject=c.id,e.push(new m(d));return e},c.prototype.createTransformResult=function(a){return null==a&&(a={}),null==a.mediaObject&&(a.mediaObject=this.get("id")),new m(a)},c}(j),i=function(a){function c(){return r=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype._fields=[["id",null],["type",null],["src",null],["width",0],["height",0]],c}(j),l=function(a){function c(){return s=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype._fields=[["id",null],["type",null],["value",null],["semanticValue",null],["transformResult",null]],c}(j),m=function(a){function c(){return t=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype._fields=[["id",null],["type",null],["data",{}],["mediaObject",null]],c.prototype.setTag=function(a){return this.set("data",{tag:a})},c.prototype.getTag=function(){var a;return a=this.get("data",{}),a.tag},c}(j),f=function(a){function d(a){var b;if(null==a&&(a={}),d.__super__.constructor.call(this,a),!a.state)throw new g("State is required");if(!a.sourceUrl)throw new g("Source URL is required");if(!a.resultsUrl)throw new g("Results URL is required");b=new k({logging:a.logging,window:parent,target:c.referrer,onStartReceiver:this._onStartReceiver(this)}),this.set("state",a.state),this.set("sourceUrl",a.sourceUrl),this.set("resultsUrl",a.resultsUrl),this.set("notifications",b),this.set("requestTimeout",a.requestTimeout||3e4)}return b(d,a),d.prototype.getData=function(a,b){return"function"==typeof a&&(b=a,a={}),null==a.endpoint&&(a.endpoint=this.get("sourceUrl")),this.request(a,function(a,c){var d;return a?b(a,c):(c.data=function(){var a,b,e,f;for(e=c.data,f=[],a=0,b=e.length;b>a;a++)d=e[a],f.push(new h(d));return f}(),b(null,c))})},d.prototype.saveData=function(a,b,c){return"function"==typeof b&&(c=b,b={}),b.body=a,null==b.endpoint&&(b.endpoint=this.get("resultsUrl")),null==b.method&&(b.method="POST"),this.request(b,function(a,b){return a?c(a,b):c(null,b)})},d.prototype.request=function(a,b){var c,d,e,f,g,h,i,j,k,l;return h=this,f=a.method||"GET",e=a.endpoint||"",c=JSON.stringify(a.body||{}),g=a.qs||{},k=e,this.get("state")&&(g.state=this.get("state")),g.cookie_fix=0,d=p(g),d&&(k+="?"+d),l=new XMLHttpRequest,l.open(f,k,!0),a.body&&(l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Accept","application/json")),l.onerror=function(a){return clearTimeout(i),h.log("XHR Request Error "+f+" - "+k),"function"==typeof b?b(!0,a):void 0},l.onload=function(a){var c;clearTimeout(i),h.log("XHR Request Success "+f+" - "+k);try{a=JSON.parse(l.responseText)}catch(d){c=d,console.error(c)}return"function"==typeof b?b(c||!1,a):void 0},j=function(){return l.abort(),h.log("XHR Request Timeout "+f+" - "+k),h.onRequestTimeout()},i=setTimeout(j,this.requestTimeout),h.log("XHR Request Calling "+f+" - "+k),l.send(c)},d.prototype.success=function(){return this.notifications.sendSuccess()},d.prototype.error=function(a){return this.notifications.sendError(a.message)},d.prototype._onStartReceiver=function(a){return function(){return a.notifications.sendStarted(),a.onStart()}},d.prototype.onStart=function(){return this.log(new g("onStart: Not implemented"))},d.prototype.onRequestTimeout=function(){return this.error(new g("XHR Request Timeout"))},d}(e),a.Tagasauris={VERSION:"0.0.1",ChildClient:f,MediaObject:h,MediaObjectItem:i,TransformResult:m,Score:l}}(window,document)}).call(this);